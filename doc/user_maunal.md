<h1 align="center">数据中台系统</h1>

<h2 align="center">V1.0用户手册</h2>

[TOC]

## 软件概述

数据中台系统是一个将数据服务发布、管理、维护、测试等多项业务集成于一体的数据服务管理系统。将数据服务发布平台化是为了简化用户发布数据服务的流程，用户不必关注于业务逻辑之外的内容，能够以更简洁的方式帮助用户快速高效地发布数据服务，从而提高用户的使用体验。此外，本系统还提供了对数据服务的状态检测功能，支持测试接口的可用性并及时发现接口异常，从而帮助用户快速诊断接口故障，及时修复以保证系统稳定性，提升用户的体验感。

本软件旨在简化数据服务的发布流程，并提供一个数据中心，使用户能够及时观察到各个数据服务的运行状态，保证数据服务的正常运行，可以及时将接口状态同步到监控日志系统，并生成接口的测试报告。

## 软件说明

本系统基于SpringBoot框架对数据服务进行封装，并基于kubernetes实现数据服务的部署、测试和管理，用户只需要编写简单的mybatis代码即可实现数据服务的发布。系统的主要流程图如下：

![](.\img\数据中台系统主要流程图.png)

整体的系统运行步骤如下所示：

- 用户编辑好所需要的数据服务信息，一般以myBatis的格式编写数据服务代码（针对关系型数据库），并设置数据服务的服务名称、数据源、服务描述和服务分组等信息；
- 系统会自动识别myBatis代码中的参数，生成相应的参数模块，用户可以修改参数的类型和描述信息来进行补充描述；
- 用户确认数据服务和参数信息后，将数据服务保存至数据库中；
- 在数据服务管理页面，用户可以查看所有的数据服务信息，包括数据服务的访问路径、参数信息、发布时间等，并提供对数据服务的测试、修改、发布、删除功能。

## 环境需求

​		本系统需要保证部署机器可以正常部署服务至docker中并连接kubernetes集群，系统运行环境及软件依赖如下：

- 操作系统： CentOS 7.9 和 fedora30
- 内存：>=4GB
- CPU核：>=4
- Docker：1.13.1
- Kubernetes：v1.27.4
- Nginx：1.20.1
- Python：>= 2.7.5

## 环境搭建与配置

### 配置系统环境

按照章节3中所需的依赖搭建软件环境。

### 连接k8s集群

在我们的java项目中，需要修改的配置信息如下：

|                  | 文件                        | 描述                                                         |
| ---------------- | --------------------------- | ------------------------------------------------------------ |
| K8scli微服务     | kubernetesconfig_proc.yaml  | 集群配置信息                                                 |
|                  | base_deployment.yaml        | Deployment配置详情，需要修改的地方是image，我们会提供一个标准的镜像供参考 |
|                  | application-test.properties | 微服务配置信息，需要修改：spring.datasource配置信息；eureka.client.service-url.defaultZone注册中心 |
| ApiService微服务 | application.yaml            | 微服务配置信息，需要修改：spring.datasource配置信息；eureka.client.service-url.defaultZone注册中心 |
| Gateway微服务    | application.yaml            | 微服务配置信息，需要修改：spring.datasource配置信息；eureka.client.service-url.defaultZone注册中心；spring.redis配置信息；spring.cloud.sentinel流控配置信息；路由转发中，dataService的转发路径（设置为集群中接收请求的uri） |

### 部署系统

将整个文件架构上传至服务器中，配置nginx和集群之后运行系统。

- 项目部署目录：

![项目部署目录](.\img\项目部署目录.png)

- nginx端口配置：

![](.\img\nginx端口配置.png)

- Kubernetes代理端口配置：

![](.\img\Kubernetes代理端口配置.png)

配置好相关的路径和配置项之后,使用 `nohup java -jar ApiService-0.0.1-SNAPSHOT.jar &` 命令运行系统：

![](.\img\运行系统.png)

## 软件功能及操作说明

系统主要根据用户设计和编写的数据服务，动态提供数据服务的发布、管理、扩展、测试等功能，并将对所有数据服务提供一个管理平台，支持测试接口的可用性并及时发现接口异常。此外，系统还对数据服务提供了插件扩展支持，现已支持四种不同类型的插件，涵盖关键字凭据验证、访问权限控制、访问频率控制和动态水平拓展四个方向。

编写数据服务并保存至数据库中：

<img src=".\img\编写数据服务并保存至数据库中.png" style="zoom: 67%;" />

用户选择发布数据服务后，系统自动替换xml文件中的内容，生成对应的数据服务并发布至k8s集群中。

- 系统自动替换数据服务内容：

<img src=".\img\系统自动替换数据服务内容.png" style="zoom:67%;" />

- 生成数据服务并发布至集群：

<img src=".\img\生成数据服务并发布至集群.png" style="zoom:67%;" />

- Kubernetes统一管理数据服务容器：

<img src=".\img\查看集群中数据服务容器状态.png" style="zoom: 67%;" />

- 系统在API管理中心中提供所有数据服务的全局视图，支持测试接口的可用性并及时发现接口异常：

<img src=".\img\数据服务管理中心.png" style="zoom: 33%;" />

- 系统支持根据API分组筛选数据服务：

<img src=".\img\数据服务管理中心筛选分组.png" style="zoom: 33%;" />

- 编写并保存新数据服务，系统将根据用户编写的数据服务代码动态生成当前数据服务对应的参数，并支持用户设置请求参数的属性：

<img src=".\img\创建数据服务接口.png" style="zoom: 33%;" />

- 查看、修改数据服务，用户修改数据服务代码并保存后，系统将自动匹配前后参数变化，调整数据服务的参数信息：

<img src=".\img\数据服务详情.png" style="zoom:33%;" />

- 测试数据服务：

<img src=".\img\数据服务测试.png" style="zoom: 33%;" />

- 数据服务管理模块：

<img src=".\img\数据服务分组管理模块.png" style="zoom: 33%;" />

- 数据服务插件管理：

<img src=".\img\数据服务分组插件机制.png" style="zoom:33%;" />

- 为数据服务添加插件：

<img src=".\img\添加插件.png" style="zoom: 33%;" />

- 插件管理：

<img src=".\img\插件管理.png" style="zoom: 33%;" />

